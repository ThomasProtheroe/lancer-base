<!DOCTYPE html>
<html>

<head>
	<title>Zen Console</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
		integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
		crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
		integrity="sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd" crossorigin="anonymous">
	<link rel="stylesheet" href="/css/styles.css">
	<link rel="stylesheet" href="/css/gm.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.8/handlebars.min.js" integrity="sha512-E1dSFxg+wsfJ4HKjutk/WaCzK7S2wv1POn1RRPGh8ZK+ag9l244Vqxji3r6wgz9YBf6+vhQEYJZpSjqWFPg9gg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/Javascript" src="logTemplate.js"></script>
</head>

<body>
	<div class="container">
		<div class="row row-cols-2" style="flex-direction: row;">
			<h1>Zen Console</h1>
			<div style="display: flex;">
				<button type="button" onclick="triggerReload()" style="margin-left: auto; align-self: center;">Force Reload</button>
			</div>
		</div>
		<hr/>
		<div id="log-container" class="row">Loading...</div>
		<div id="ability-container" class="row">
			<h1>Ability Dashboard</h1>
			<div class="row">
				<div class="col">
					<span class="condition-text">Identity: </span>
					<div class="status-bar">
						<div id="condition-fill" class="status-bar-fill"><span id="stats-identity"></span></div>
					</div>
				</div>
			</div>
			<div class="row info-container my-1">
				<div class="row align-items-center py-2">
					<div class="col">
						<span  class="addon-header">Abilities</span>
					</div>
				</div>
				<div id="zen-abilities-container" class="row row-cols-4"></div>
			</div>
		</div>
	</div>

	<script>
		const addAbility = (ability) => {
			$('#zen-abilities-container').append(
				`<div class="col">
					<div class="addon-item">
						<div class="addon-name">${ability['name']}</div>
						<div class="item-costs"><span class="item-cost-item"><i class="bi bi-heart-pulse-fill""></i> ${ability.cost}</span></div>
						<div class="addon-description">${ability['description']}</div>
						<button class="base-btn">Activate</button>
					</div>
				</div>`
			);
		};

		fetch('./zen', {
			method: "GET",
			headers: {
				"Content-type": "application/json; charset=UTF-8"
			}
		}).then((response) => response.json())
			.then((responseJson) => {
				responseJson.abilities.forEach(ability => {
					addAbility(ability);
				});
			});

		$('#facilities-container').find('.addon-item').each((i, addon) => {
			if ($(addon).data('addon')['name'] === facility['name']) {
				built = true;
			}
		});
	</script>

	<!-- Component Render functions -->
	<script>
		async function triggerReload() {
			await fetch('/base/refresh', {
				method: 'POST'
			})
			await fetch('/reloadPage', {
				method: 'POST'
			})
			location.reload();
		}
	</script>
	<!-- App Start Up -->
	<script>
		// Global State object
		this.state = {
			selectedPilot: "Zen"
		};

		async function init() {
			try {
				const response = await fetch(`./log`);
				this.state.logs = await response.json();
			} catch (err) {
				console.error(`Error: ${err}`);
			}

			renderAll();
		}

		function renderAll() {
			renderLogs();
		}

		function updateZen(zenData) {
			// TODO use this to update Zen
			console.log(zenData.identity);
		}
		
		init();
	</script>
	<script>
		const socket = io();
		socket.on('activity_log', (msg) => {
			addLog(msg);
			
		});
		socket.on('gm_sound', (msg) => {
			const sound = new Audio(msg);
			sound.play();
		});
		socket.on('zen_update', (msg) => {
			updateZen(msg);
		});
	</script>
</body>

</html>